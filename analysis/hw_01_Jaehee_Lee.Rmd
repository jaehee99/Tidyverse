---
title: "STAT 413/613 HW 1"
author: "Jaehee Lee"
date: "`r Sys.Date()`"
output:
  html_document: 
    number_sections: true
editor_options:
  chunk_output_type: inline
urlcolor: blue
params:
  solutions: FALSE
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
                      fig.align  = "center",
                      fig.height = 4, 
                      fig.width  = 6)
```

# Instructions {-}

Admin elements:  
1. Upload a photo (headshot) of yourself into your canvas profile  
2. Review the Syllabus and the [academic integrity code](<https://www.american.edu/policies/students/upload/academic-integrity-code-2020.pdf>).  
3. Fill in your information in the Student Info spreadsheet under the Canvas Collaboration site.  

Analysis Elements: Rename the starter file under the analysis directory as `hw_01_yourname.Rmd` and use it for your solutions.   
1. Modify the "author" field in the YAML header.  
2. Stage and Commit R Markdown and HTML files (no PDF files).   
3. **Push both .Rmd and HTML files to GitHub**.   
  - Make sure you have knitted to HTML prior to staging, committing, and pushing your final submission.  
4. **Commit each time you answer a part of question, e.g. 1.1**   
5. **Push to GitHub after each major question**, e.g., College Scorecard and World Bank Data     
  - **Committing and Pushing are graded elements for this homework.**  
6. When complete, submit a response in Canvas that you have completed the homework. No need to submit your files.  
    
- Only include necessary code to answer the questions.
- Most of the functions you use should be from the tidyverse. Too much base R will result in point deductions.
- Use Pull requests and or email to ask me any questions. If you email, ensure your most recent code is pushed to GitHub whether it is working or not.

# Learning Outcomes:  {-}
- Operate with Git and GitHub.
- Apply concepts and methods from STAT 412/612.   

# Canvas Picture, Syllabus, and Student Info
Review the Syllabus on Canvas and answer the following questions:

I, *Jaehee Lee*  have:

1. Added a photo of myself (headshot) to my Canvas profile: Yes

2. Reviewed the syllabus and the associated policies on the following date: _January 25, 2021___________

3. Reviewed the American University policies on academic integrity, and understand how they apply to this course and  agree to comply with them for this course: Yes

4. Filled in my information in the Student Info spreadsheet on Canvas collaborations: Yes

# College Scorecard

The data folder contains "college_score_200601.csv", a subset of the data in the [College Scorecard](https://collegescorecard.ed.gov/data/) database as of June 1, 2020. These data contain information on colleges in the United States. The variables include:

- `UNITID` and `OPEID`: Identifiers for the colleges.
- `INSTNM`: Institution name
- `ADM_RATE`: The Admission Rate.
- `SAT_AVE`: Average SAT equivalent score of students admitted.
- `UGDS`: Enrollment of undergraduate certificate/degree-seeking students
- `COSTT4_A`: Average cost of attendance (academic year institutions)
- `AVGFACSAL`: Average faculty salary
- `GRAD_DEBT_MDN`: The median debt for students who have completed
- `AGE_ENTRY`: Average age of entry
- `ICLEVEL`: Level of institution (1 = 4-year, 2 = 2-year, 3 = less than 2-year).
- `MN_EARN_WNE_P10`: Mean earnings of students working and not enrolled 10 years after entry.
- `MD_EARN_WNE_P10`: Median earnings of students working and not enrolled 10 years after entry.
- `FEMALE`: Share of female students
- `PCT_WHITE`: Percent of the population from students' zip codes that is White, via Census data
# load packages
```{r}
install.packages("viridis")
library(readr)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library("viridis")           
```
1. Use a relative path and a readr function to load the data from data/college_score_200601.csv into a tibble.
```{r}
cs <- read_csv("college_score_200601.csv")
str(cs)
```

2. If you used the default settings for reading in the data, 11 variables are probably type character when they should be numeric. 
  + Which ones? 
Answer: MN_EARN_WNE_P10, MD_EARN_WNE_P10, SAT_AVG, ADM_RATE, UGDS, COSTT4_A, AVGFACSAL, GRAD_DEBT_MDN,AGE_ENTRY,FEMALE, PCT_WHITE
  + Why were they read in as type character? 
Answer: They were read in as type character because the numbers are inside Quotation(" "). For example, 7 and "7" are different type. I think computer will think 7 is numeric, however "7" will be recognized as character, since 7 is inside the quotation.

3. Use a readr function to fix these variables to be numeric and save the updated tibble.
```{r}
cs$MN_EARN_WNE_P10 <- readr::parse_number(cs$MN_EARN_WNE_P10)
cs$MD_EARN_WNE_P10 <- readr::parse_number(cs$MD_EARN_WNE_P10)
cs$SAT_AVG <- readr::parse_number(cs$SAT_AVG)
cs$ADM_RATE <- readr::parse_number(cs$ADM_RATE)
cs$UGDS <- readr::parse_number(cs$UGDS)
cs$COSTT4_A <- readr::parse_number(cs$COSTT4_A)
cs$AVGFACSAL <- readr::parse_number(cs$AVGFACSAL)
cs$GRAD_DEBT_MDN <- readr::parse_number(cs$GRAD_DEBT_MDN)
cs$AGE_ENTRY <- readr::parse_number(cs$AGE_ENTRY)
cs$FEMALE <- readr::parse_number(cs$FEMALE)
cs$PCT_WHITE <- readr::parse_number(cs$PCT_WHITE)
```
```{r}
str(cs)
```

4. How is average faculty salary associated the mean earnings of students ten years after initial enrollment? Create an appropriate plot and interpret the plot to justify your answer.
```{r}
ggplot(data = cs, mapping = aes(y = AVGFACSAL, x = MN_EARN_WNE_P10)) +
  geom_point()+
  labs(y ="AVGFACSAL", x = "MN_EARN_WNE_P10")+
  theme_bw()+
  theme_classic()
```
Interpretation: 
MN_EARN_WNE_P10 and AVGFASCAL are positively correlated. For example, when MN_EARN_WNE_P10 increases then, AVGFASAL increases as well. We can detect some outliers however, the two variables are very strongly correlated. 
I can assume that higher mean earnings of students after 10 years met higher average faculty salary.


5. Does the level of the institution seem to be associated with the mean earnings of students ten years after enrollment? Reproduce this plot in R to explore this relationship and interpret the plot:
```{r}
ggplot(data = cs, aes(y = log(MN_EARN_WNE_P10), x = factor(ICLEVEL))) +
  geom_boxplot(alpha=0.2)+
  xlab("Level of Institution")+
  ylab("Log of Mean Earnings")+
  ggtitle("Mean Earnings 10 Years after Enrollment by Level of Institution")+
  theme_bw()
```
Interpretation: 
Level of institution (1 = 4-year, 2 = 2-year, 3 = less than 2-year)
The median of institution level 1 is the highest among three of the institution levels. This indicates that students who graduated 4-year university have a highest median earnings in the future 10 years among three levels. Furthermore, level 2 institution have higher median than level 3. Not all, but most of the people who graduated 4-year institution have higher earnings than people who graduated 2-years institution. People who graduated 2-years institution have higher earning than level 3. 

6. Plot the mean earnings 10 years after enrollment for level 1 institutions as the Y axis against PCT_WHITE and, in a second plot, against FEMALE.  
- Use a log scale as appropriate.
- Add a loess smoother. 
- Describe and interpret the relationship, if any, in each of the plots.
```{r}
# Plot the mean earnings 10 years after enrollment for Level 1 institutions as the Y-axis against PCT_WHITE Plot 1:
cs %>% 
  filter(ICLEVEL == 1) %>%  
  ggplot(aes(y = MN_EARN_WNE_P10, x = PCT_WHITE)) +
  geom_point()+
    geom_smooth(method = "loess",color='black') +
  labs(y ="mean earnings level 1", x = "PCT_WHITE")+
 scale_y_log10()+
  theme_classic()

# Plot the mean earnings 10 years after enrollment for Level 1 institutions as the Y-axis against FEMALE Plot 2:
cs %>% 
  filter(ICLEVEL == 1) %>%  
ggplot(aes(y= MN_EARN_WNE_P10, x = FEMALE)) +
  geom_point() +
    geom_smooth(method = "loess",color='black') +
  labs(y = "mean earnings level 1", x = "FEMALE")+
 scale_y_log10()+
  theme_classic() 
```
Interpretation: 
Plot 1) For level 1 institution, when PCT_WHITE is around 75~90, the mean earnings are around 30000~50000. Most of the dots are highly densed in this range. Also, the loess line shows that when PCT_WHITE increases until 75, meaning earnings also increases, however, after PCT_WHITE is 75, the loess line slightly decreases. 

Plot 2) For level 1 institution, the most of the dots are densed around when FEMALE students are around 0.50 ~0.75. When x-axis FEMALE is around 0.50~0.75, then mean earnings are around 50000. This indicates that when the university is 4-year institution with 'Share of Female students' 0.50~0.75, then the mean earnings 10 years after is around 50000. Furthermore, the loess line is almost horizontal to the x-axis, which indicates that regardless of the 'Share of Female students' value, mean of earnings after 10 years will be around 50000. 


7. Create a scatter plot of the mean earnings 10 years after enrollment (Y) axis) compared to the median earnings 10 years after enrollment (X axis) using log scales for both.  
  + Add an abline. 
  + Interpret the plot and the relationship between the two variables.
```{r}
ggplot(data = cs, mapping = aes(y = MN_EARN_WNE_P10, x = MD_EARN_WNE_P10)) +
  geom_point()+
  scale_y_log10()+
  scale_x_log10() +
  labs(y ="MN_EARN_WNE_P10", x = "MD_EARN_WNE_P10")+
  theme_classic()+
    geom_abline(color = "blue", size = 2.0)
```
Interpretation: Above graph shows that MD_EARN_WNE_P10 and MN_EARN_WNE_P10 are linearly related. They are showing strong correlation since the dots are well aligned with the abline that is blue. This indicates that when the median earnings 10 year after enrollment increases, then mean earnings 10 years after enrollment increases. 

8. Compute a ranking of level 1 universities based on the ratio of mean earnings 10 years after enrollment compared to median graduation debt.   
  + Identify the top 5 best (highest ROI should be #1 ) and the bottom 5 worst? 
  + What is American University's rank and ROI? 
```{r}
cs %>% 
  filter(ICLEVEL == 1) -> cs_1
# RATIO
cs_1$RATIO <- cs_1$MN_EARN_WNE_P10/cs_1$GRAD_DEBT_MDN
# Top 5 best
cs_1 %>% 
  arrange(desc(RATIO)) %>% 
  top_n(5) %>%  
  select(INSTNM, RATIO) -> ratio_top_5
# Bottom 5 worst
cs_1 %>% 
  arrange(RATIO) %>% 
  head(5) %>%  
    select(INSTNM, RATIO) -> ration_bottom_5
# What is American University's ROI? 
cs_1 %>% 
  filter(INSTNM == "American University") %>%  
  select(RATIO) -> AU_ROI
# What is American University's Rank? 
cs_1 %>% 
  arrange(desc(RATIO)) %>%
  mutate(rank = row_number()) %>%  
  filter(INSTNM == "American University") %>% 
  select("rank") -> AU_RANK
```

- Extra Credit: 
  + Reproduce the following plot so the *AU line automatically adjusts as the new data is entered*:
  + What is AU's new ranking and ROI if the median earnings are used?
```{r}
ggplot(cs_1, aes(x=RATIO)) +
  geom_histogram(binwidth = 0.26)+
    theme_bw()+
  ggtitle("Ratio of Mean Earnings 10 Years after Enrollment to Median Debt at Graduation")+
    geom_vline(aes(xintercept = 2.907077, color = "dark red")) 

# What is AU's new ranking and ROI if the median earnings are used?
cs_1$RATIO_MD <- cs_1$MD_EARN_WNE_P10/cs_1$GRAD_DEBT_MDN
# What is American University's ROI_MD? 
cs_1 %>% 
  filter(INSTNM == "American University") %>%  
  select(RATIO_MD) -> AU_ROI_MD
# What is American University's Rank_MD? 
cs_1 %>% 
  arrange(desc(RATIO_MD)) %>%
  mutate(rank = row_number()) %>%  
  filter(INSTNM == "American University") %>% 
  select("rank") -> AU_RANK_MD
```

# World Bank Data

The World Bank provides loans to countries with the goal of reducing poverty. The dataframes in the data folder were taken from the public data repositories of the World Bank.

- country.csv: Contains information on the countries in the data set. 
  - The variables are:
  - `Country_Code`: A three-letter code for the country. Note not all rows are countries; some are regions.
  - `Region`: The region of the country.
  - `IncomeGroup`: Either `"High income"`, `"Upper middle income"`, `"Lower middle income"`, or `"Low income"`.
  - `TableName`: The full name of the country.  

- fertility.csv: Contains the fertility rate information for each country for each year. 
  + For the variables `1960` to `2017`, the values in the cells represent the fertility rate in total births per woman for that year. 
  + Total fertility rate represents the number of children that would be born to a woman if she were to live to the end of her  childbearing years and bear children in accordance with age-specific fertility rates of the specified year.   

- life_exp.csv: Contains the life expectancy information for each country for each year. 
  + For the variables `1960` to `2017`, the values in the cells represent life expectancy at birth in years for the given year. 
  + Life expectancy at birth indicates the number of years a newborn infant would live if prevailing patterns of mortality at the time of its birth were to stay the same throughout its life.  

- population.csv: Contains the population information for each country. 
  + For the variables `1960` to `2017`, the values in the cells represent the total population in number of people for the given year. 
  + Total population is based on the de facto definition of population, which counts all residents regardless of legal status or citizenship. The values shown are midyear estimates.

1. Use relative paths and a readr function to load these files into four tibbles.  
```{r}
life_expectancy <- read_csv("life_exp.csv")
fertility <- read_csv("fertility.csv")
population <- read_csv('population.csv')
country <- read_csv('country.csv')
```

2. These data are messy. The observational units in `fert`, `life`, and `pop` are locations in space-time (e.g. Aruba in 2017). Recall tidy data should have one observational unit per row.  
  - Use dplyr 1.0 functions to tidy these three tibbles and save the updated data frames.
  - Use an approach where the tidying function also ensures the variable for `year` is a numeric.  
```{r}
# In order to tidy datasets like these messy, I have to "gather" those columns into a new pair of variables.
population %>%  
  gather(colnames(population)[3:61], key = "year", value = "population") -> population_tidy

life_expectancy %>%  
  gather(colnames(life_expectancy)[3:61], key = "year", value = "life_expectancy") -> life_expectancy_tidy

fertility %>%  
  gather(colnames(life_expectancy)[3:61], key = "year", value = "fertility")  -> fertility_tidy
```

3. Use dplyr functions to combine the three tibbles into one and save to a new tibble which includes the fertility rate, population, and life expectancy in each year as well as the region for each country.
```{r}
full_join(population_tidy, life_expectancy_tidy, by = c("Country Name","Country Code", "year"))-> pop_life
full_join(pop_life, fertility_tidy, by = c("Country Name","Country Code", "year")) -> pop_life_fert
full_join(pop_life_fert, country, by = "Country Code") -> pop_life_fert_country
```

4. Make a scatterplot of fertility rate vs life expectancy, color-coding by region and annotating size by the population.  
  + Include only the years 1960, 1970, 1980, 1990, 2000, and 2010. 
  + Facet by these years.
  + Your final plot should look like this (Each element of the formatting is graded):
  + **Interpret the plot in one sentence**.
```{r}
pop_life_fert_country %>%  
  drop_na() %>% 
  filter(year == "1960"|year == "1970"|year == "1980"|year == "1990"|year == "2000"|year == "2010") %>%  
  ggplot(aes(life_expectancy, fertility, color = Region))+
  geom_point(aes(size = population))+
  facet_wrap(. ~year)+ 
  ggtitle("Changes by Region across Decades \nWorld Bank Data") +
  ylab("Fertility Rate")+
  xlab("Life Expectancy")+
  scale_color_viridis(discrete = TRUE, option = "D") +
 scale_fill_viridis(discrete = TRUE) 
```

5. Calculate the total population for each region for each year.  
  + Exclude 2018.  
  + Make a line plot of year versus total population, color-coding by region and using a log scale.
  + Your final plot should look like this:
  + **Interpret the plot in one sentence to identify the fastest growing regions**.
```{r}
pop_life_fert_country %>%  
  filter(year != 2018)  %>%  
  group_by(year, Region) %>%  
  drop_na() %>% 
  summarize(total = sum(population)) -> new_data

ggplot(data = new_data, aes(x=year,y=total, group = Region))+
geom_line(aes(colour=Region))+ 
  theme_classic() +
ggtitle("Population by Region") +
xlab("Years")+
ylab("Log of Total Population")+
  scale_y_log10()+
  scale_x_discrete(breaks = c("1960","1980","2000"))+
    scale_color_brewer(palette="Dark2") 

```
Interpretation: Since the x-axis is same for all regions which is years(from 1960 to 2017), so I have to consider only y-axis to find out the fastest growing regions. When the difference between the starting point of the y-value and the last point of the y-value is the biggest among 7 regions, then that region is the fastest growing region. But I have to carefully see the y-scale since I did y scale log.Therefore, the regions where the differences seems to be greatest here is "East Asia and the Pacific", indicating thatthe fastest growing region is East Asia & Pacific. 
  
6. Make a bar plot of population vs region for the year 2010.  
  + Order the bars on the $y$-axis in **decreasing** order of population. 
  + Your final plot should look like this:
```{r}
pop_life_fert_country %>% 
  drop_na() %>% 
  filter(year == 2010) %>%  
  select(Region, population) %>%  
  ggplot(aes(x = reorder(Region, -population,sum), y = population/1000000)) + 
  geom_bar(stat = "identity", fill = '#0000FF') +
  coord_flip()+
  theme_bw() +
  labs(x = NULL, y = NULL, title = "2010 Population by Region")
```

